{
  "openapi": "3.0.2",
  "info": {
    "title": "Movie Filter API (Actions)",
    "version": "1.0.0"
  },
  "servers": [
    { "url": "https://movie-filter-api.onrender.com" }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer" }
    },
    "schemas": {
      "GenerateRequest": {
        "type": "object",
        "required": ["style_hint"],
        "properties": {
          "style_hint": { "type": "string", "maxLength": 500 },
          "k": { "type": "integer", "minimum": 1, "maximum": 10, "default": 10 },
          "n": { "type": "integer", "minimum": 1, "maximum": 80, "default": 10 }
        }
      },
      "Item": {
        "type": "object",
        "required": ["movie", "scene", "behind", "vibe_point"],
        "properties": {
          "movie": { "type": "string", "maxLength": 80 },
          "scene": { "type": "string", "maxLength": 140 },
          "behind": { "type": "string", "maxLength": 160 },
          "vibe_point": { "type": "string", "maxLength": 120 }
        }
      },
      "GenerateResponse": {
        "type": "object",
        "required": ["ok", "k", "n", "count", "items"],
        "properties": {
          "ok": { "type": "boolean" },
          "k": { "type": "integer" },
          "n": { "type": "integer" },
          "count": { "type": "integer" },
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Item" }
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "required": ["ok"],
        "properties": {
          "ok": { "type": "boolean" }
        }
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "operationId": "health",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HealthResponse" }
              }
            }
          }
        }
      }
    },
    "/generate": {
      "post": {
        "operationId": "generate",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/GenerateRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/GenerateResponse" }
              }
            }
          },
          "401": { "description": "Missing Authorization" },
          "403": { "description": "Invalid API key" },
          "422": { "description": "Validation error" }
        }
      }
    }
  }
}
